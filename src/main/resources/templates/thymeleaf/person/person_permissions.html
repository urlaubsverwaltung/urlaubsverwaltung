<!DOCTYPE html>
<html lang="en" th:lang="${language}" th:class="|tw-${theme}|" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="_layout::head(~{::title}, ~{}, ~{::scripts})">
    <title th:text="#{person.form.permissions.header.title}"></title>
    <th:block th:fragment="scripts">
      <script defer asset:src="person_form.js"></script>
    </th:block>
  </head>
  <body th:replace="_layout::body(~{::main}, ~{})">
    <main th:fragment="main" class="tw-max-w-6xl tw-mx-auto tw-px-4 lg:tw-px-12 xl:tw-px-1.5">
      <div th:replace="fragments/section-heading::section-heading(~{::person-permissions-body}, ~{})">
        <th:block th:ref="person-permissions-body">
          <h2 th:text="#{person.form.permissions.title(${person.niceName})}">Berechtigungen f√ºr</h2>
        </th:block>
      </div>

      <div class="tw-flex tw-items-center tw-gap-4 sm:tw-gap-6 tw-mb-4 md:tw-mb-12">
        <div class="tw-p-1">
          <img
            th:replace="fragments/avatar::avatar-bordered(url=${person.gravatarURL + '?d=mm&s=120'},username=${person.niceName},width='60px',height='60px')"
            alt=""
          />
        </div>
        <div>
          <div class="tw-mb-1">
            <a
              th:text="${person.niceName}"
              th:href="@{/web/person/__${person.id}__/overview}"
              class="tw-text-lg print:no-link"
            ></a>
          </div>
          <a th:href="|mailto:${person.email}|" class="tw-text-sm print:no-link">
            <span class="tw-flex tw-items-center">
              <svg th:replace="icon/mail::svg(className='tw-w-4 tw-h-4')"></svg>
              <th:block th:text="${person.email}" />
            </span>
          </a>
        </div>
      </div>

      <form
        method="post"
        th:action="@{/web/person/__${person.id}__/permissions}"
        th:object="${person}"
        class="form-horizontal"
      >
        <input type="hidden" th:field="*{id}" th:value="${person.id}" />
        <input type="hidden" th:field="*{niceName}" th:value="${person.niceName}" />
        <input type="hidden" th:field="*{gravatarURL}" th:value="${person.gravatarURL}" />
        <input type="hidden" th:field="*{email}" th:value="${person.email}" />

        <div class="form-section tw-mb-16">
          <div class="row">
            <p class="alert alert-danger" th:if="${#fields.hasErrors('permissions')}">
              <th:block th:errors="*{permissions}"> permissions Error</th:block>
            </p>

            <p class="alert alert-danger" th:if="${#fields.hasErrors('notifications')}">
              <th:block th:errors="*{notifications}"> notifications Error</th:block>
            </p>

            <aside class="col-md-4 col-md-push-8">
              <p class="help-block tw-text-sm">
                <svg th:replace="icon/information-circle::svg(className='tw-w-4 tw-h-4')"></svg>
                <th:block th:text="#{person.form.permissions.description}" />
              </p>
            </aside>

            <div class="col-md-8 col-md-pull-4">
              <div class="form-group is-required">
                <div class="col-md-9">
                  <div class="checkbox tw-pb-2 tw-mb-2">
                    <strong th:text="#{person.form.permissions.roles.INACTIVE}" class="tw-mb-2 tw-block"></strong>
                    <label class="tw-leading-snug">
                      <input type="checkbox" th:field="*{permissions}" value="INACTIVE" />
                      <th:block th:text="#{person.form.permissions.roles.INACTIVE.description}" />
                    </label>
                  </div>

                  <div class="checkbox tw-pb-2 tw-mb-2">
                    <strong th:text="#{person.form.permissions.roles.USER}" class="tw-mb-2 tw-block"></strong>
                    <label class="tw-leading-snug">
                      <input type="checkbox" th:field="*{permissions}" value="USER" />
                      <th:block th:text="#{person.form.permissions.roles.USER.description}" />
                    </label>
                    <!-- It's obligatory for now that users get mail notifications about progress of their own applications for leave -->
                    <input type="hidden" name="notifications" value="NOTIFICATION_USER" />
                  </div>

                  <h2 th:text="#{person.form.permissions.roles.basic_roles.description}" class="tw-mb-2 tw-block"></h2>
                  <div class="checkbox tw-pb-2 tw-mb-2">
                    <strong
                      th:text="#{person.form.permissions.roles.DEPARTMENT_HEAD}"
                      class="tw-mb-2 tw-block"
                    ></strong>
                    <label class="tw-leading-snug tw-mb-2">
                      <input type="checkbox" th:field="*{permissions}" value="DEPARTMENT_HEAD" />
                      <th:block th:text="#{person.form.permissions.roles.DEPARTMENT_HEAD.description}" />
                    </label>
                    <label class="tw-leading-snug tw-ml-5 tw-pb-2">
                      <input type="checkbox" th:field="*{notifications}" value="NOTIFICATION_DEPARTMENT_HEAD" />
                      <th:block th:text="#{person.form.notifications.DEPARTMENT_HEAD}" />
                    </label>
                    <label th:class="|tw-leading-snug ${not #lists.isEmpty(departments) ? 'info' : ''}|">
                      <svg th:replace="icon/information-circle::svg(className='tw-w-4 tw-h-4')"></svg>
                      <th:block
                        th:if="${#lists.isEmpty(departments)}"
                        th:text="#{person.form.permissions.roles.DEPARTMENT_HEAD.departments.none.description}"
                      />
                      <th:block th:if="${not #lists.isEmpty(departments)}">
                        <th:block th:text="#{person.form.permissions.roles.DEPARTMENT_HEAD.departments.description}" />
                        <th:block th:each="department, loop : ${departments}">
                          <th:block th:text="|${department.name}${!loop.last ? ',' : ''}|" />
                        </th:block>
                      </th:block>
                    </label>
                  </div>

                  <div class="checkbox tw-pb-2 tw-mb-2">
                    <strong
                      th:text="#{person.form.permissions.roles.SECOND_STAGE_AUTHORITY}"
                      class="tw-mb-2 tw-block"
                    ></strong>
                    <label class="tw-leading-snug tw-mb-2">
                      <input type="checkbox" th:field="*{permissions}" value="SECOND_STAGE_AUTHORITY" />
                      <th:block th:text="#{person.form.permissions.roles.SECOND_STAGE_AUTHORITY.description}" />
                    </label>
                    <label class="tw-leading-snug tw-ml-5 tw-pb-2">
                      <input type="checkbox" th:field="*{notifications}" value="NOTIFICATION_SECOND_STAGE_AUTHORITY" />
                      <th:block th:text="#{person.form.notifications.SECOND_STAGE_AUTHORITY}" />
                    </label>
                    <label th:class="|tw-leading-snug ${not #lists.isEmpty(secondStageDepartments) ? 'info' : ''}|">
                      <svg th:replace="icon/information-circle::svg(className='tw-w-4 tw-h-4')"></svg>
                      <th:block
                        th:if="${#lists.isEmpty(secondStageDepartments)}"
                        th:text="#{person.form.permissions.roles.SECOND_STAGE_AUTHORITY.departments.none.description}"
                      />
                      <th:block th:if="${not #lists.isEmpty(secondStageDepartments)}">
                        <th:block
                          th:text="#{person.form.permissions.roles.SECOND_STAGE_AUTHORITY.departments.description}"
                        />
                        <th:block th:each="department, loop : ${secondStageDepartments}">
                          <th:block th:text="|${department.name}${!loop.last ? ',' : ''}|" />
                        </th:block>
                      </th:block>
                    </label>
                  </div>

                  <div class="checkbox tw-pb-2 tw-mb-2">
                    <strong th:text="#{person.form.permissions.roles.BOSS}" class="tw-mb-2 tw-block"></strong>
                    <label class="tw-leading-snug tw-mb-2">
                      <input type="checkbox" th:field="*{permissions}" value="BOSS" />
                      <th:block th:text="#{person.form.permissions.roles.BOSS.description}" />
                    </label>
                    <label class="tw-leading-snug tw-mb-2">
                      <input type="radio" th:field="*{notifications}" value="NOTIFICATION_BOSS_ALL" />
                      <th:block th:text="#{person.form.notifications.BOSS.all}" />
                    </label>
                    <label class="tw-leading-snug">
                      <input type="radio" th:field="*{notifications}" value="NOTIFICATION_BOSS_DEPARTMENTS" />
                      <th:block th:text="#{person.form.notifications.BOSS.departments}" />
                    </label>
                    <label class="tw-leading-snug">
                      <input type="radio" th:field="*{notifications}" value="" />
                      <th:block th:text="#{person.form.notifications.BOSS.none}" />
                    </label>
                  </div>

                  <div class="checkbox tw-pb-4 tw-mb-4">
                    <strong th:text="#{person.form.permissions.roles.OFFICE}" class="tw-mb-2 tw-block"></strong>
                    <label class="tw-leading-snug tw-mb-2">
                      <input type="checkbox" th:field="*{permissions}" value="OFFICE" />
                      <th:block th:text="#{person.form.permissions.roles.OFFICE.description}" />
                    </label>
                    <label class="tw-leading-snug tw-ml-5 tw-pb-2">
                      <input type="checkbox" th:field="*{notifications}" value="NOTIFICATION_OFFICE" />
                      <th:block th:text="#{person.form.notifications.OFFICE}" />
                    </label>
                    <label class="tw-leading-snug tw-ml-5 tw-pb-2">
                      <input type="checkbox" th:field="*{notifications}" value="OVERTIME_NOTIFICATION_OFFICE" />
                      <th:block th:text="#{person.form.notifications.OFFICE.overtime}" />
                    </label>
                  </div>

                  <h2
                    th:text="#{person.form.permissions.roles.additional_roles.description}"
                    class="tw-mb-2 tw-block"
                  ></h2>
                  <div class="checkbox">
                    <strong
                      th:text="#{person.form.permissions.roles.SICK_NOTE_VIEW_ADD_EDIT}"
                      class="tw-mb-2 tw-block"
                    ></strong>
                    <label class="tw-leading-snug tw-ml-5 tw-pb-2">
                      <input type="checkbox" th:field="*{permissions}" value="SICK_NOTE_VIEW_ADD_EDIT" />
                      <th:block
                        th:text="#{person.form.permissions.roles.SICK_NOTE_VIEW_ADD_EDIT.description(${person.niceName})}"
                      />
                    </label>
                  </div>
                  <div class="checkbox">
                    <strong
                      th:text="#{person.form.permissions.roles.APPLICATION_ADD_CANCEL}"
                      class="tw-mb-2 tw-block"
                    ></strong>
                    <label class="tw-leading-snug tw-ml-5 tw-pb-2">
                      <input type="checkbox" th:field="*{permissions}" value="APPLICATION_ADD_CANCEL" />
                      <th:block
                        th:text="#{person.form.permissions.roles.APPLICATION_ADD_CANCEL.description(${person.niceName})}"
                      />
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="form-section tw-mb-16">
          <hr />
          <button th:text="#{action.save}" class="button-main-green col-xs-12 col-sm-5 col-md-2" type="submit"></button>
          <button
            th:text="#{action.cancel}"
            type="button"
            class="button col-xs-12 col-sm-5 col-md-2 pull-right"
            data-back-button
          ></button>
        </div>
      </form>
    </main>
  </body>
</html>
