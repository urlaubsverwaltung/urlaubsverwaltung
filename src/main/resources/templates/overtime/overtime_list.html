<!doctype html>
<html lang="en" th:lang="${language}" th:class="|theme-${theme}|" xmlns:th="http://www.thymeleaf.org">
  <head
    th:replace="~{_layout::head(title=~{::title}, styles=~{::styles}, scriptsDefer=~{::scriptsDefer}, preload=~{::preload})}"
  >
    <title th:text="#{overtime.header.title(${person.niceName})}"></title>
    <th:block th:fragment="styles">
      <link rel="stylesheet" th:href="@{/css/overtime.css}" />
    </th:block>
    <th:block th:fragment="preload">
      <link rel="preload" th:replace="~{fragments/asset-dependency-preload::links('overtime_overview.js')}" />
    </th:block>
    <th:block th:ref="scriptsDefer">
      <script defer type="module" asset:src="overtime_overview.js"></script>
    </th:block>
  </head>
  <body th:replace="~{_layout::body(~{::main}, ~{})}">
    <main th:fragment="main" class="max-w-6xl mx-auto px-4 lg:px-12 xl:px-0">
      <div
        th:replace="~{fragments/section-heading::section-heading(~{::overtime-list-heading-body}, ~{::overtime-list-heading-actions})}"
      >
        <th:block th:fragment="overtime-list-heading-body">
          <h2 th:text="#{overtime.title}">Überstunden</h2>
          <div
            th:replace="~{fragments/year-selector::year-selector(id='year-selection', currentYear=${currentYear}, hrefPrefix=|/web/overtime?person=${person.id}&year=|, selectedYear=${selectedYear})}"
          ></div>
        </th:block>
        <th:block th:fragment="overtime-list-heading-actions">
          <a
            th:if="${userIsAllowedToCreateOvertime}"
            th:href="@{/web/overtime/new?person=__${person.id}__}"
            class="icon-link px-1"
          >
            <svg th:replace="~{icon/plus-circle::svg(className='w-5 h-5')}"></svg>&nbsp;
            <span th:text="#{action.overtime.new}"></span>
          </a>
        </th:block>
      </div>

      <div class="mb-16">
        <div class="sm:flex">
          <div class="sm:flex-1 lg:flex-none lg:w-1/3">
            <div th:replace="~{person/box::person-box(person=${person}, departments=${departmentsOfPerson})}"></div>
          </div>
          <div class="sm:flex-1 flex flex-col lg:flex-row gap-y-8">
            <div class="flex-1">
              <div th:replace="~{overtime/box::overtime-box-total(overtimeTotal=${overtimeTotal})}"></div>
            </div>
            <div class="flex-1">
              <div th:replace="~{overtime/box::overtime-box-left(overtimeLeft=${overtimeLeft})}"></div>
            </div>
          </div>
        </div>
      </div>

      <div>
        <ol class="overtime-list">
          <li role="presentation" class="mb-1 font-medium text-sm">
            <span data-grid-ref="plus-minus-icon"></span>
            <span data-grid-ref="absence-type-box"></span>
            <span data-grid-ref="title" th:text="#{overtime.list.col.date}"> Überstundenauf-/abbau </span>
            <span data-grid-ref="date-range"></span>
            <span data-grid-ref="info-split-year" th:text="#{overtime.list.col.duration}">
              Geleistete Überstunden
            </span>
            <span data-grid-ref="sum" th:text="#{overtime.list.col.sum}"> Summe der Überstunden </span>
            <span data-grid-ref="action-buttons"></span>
          </li>
          <th:block th:each="record,it : ${records}">
            <li role="separator"></li>
            <li
              th:with="recordDetailsUrl=${record.type == 'OVERTIME' ? '/web/overtime/__${record.id}__' : '/web/application/__${record.id}__'}"
              th:onclick="|navigate('__${recordDetailsUrl}__');|"
            >
              <span data-grid-ref="plus-minus-icon">
                <th:block th:if="${record.negative}">
                  <span th:replace="~{icon/arrow-down::svg(className='w-5 h-5')}"></span>
                </th:block>
                <th:block th:if="${record.positive}">
                  <span th:replace="~{icon/arrow-up::svg(className='w-5 h-5')}"></span>
                </th:block>
              </span>
              <span data-grid-ref="absence-type-box">
                <th:block th:if="${record.type == 'OVERTIME'}">
                  <span class="w-3 inline-block"></span>
                </th:block>
                <th:block th:if="${record.type == 'ABSENCE'}">
                  <span
                    class="absence-type_color-box w-3 inline-block"
                    th:classappend="|${record.status == 'WAITING' ? 'absence-type_color-box-waiting' : ''} ${record.status == 'TEMPORARY_ALLOWED' ? 'absence-type_color-box-temporary-allowed' : ''} ${record.status == 'ALLOWED' ? 'absence-type_color-box-allowed' : ''} ${record.status == 'ALLOWED_CANCELLATION_REQUESTED' ? 'absence-type_color-box-cancellation-requested' : ''} ${record.status == 'CANCELLED' ? 'absence-type_color-box-cancelled' : ''} ${record.status == 'REJECTED' || record.status == 'REVOKED' ? 'absence-type_color-box-rejected-revoked' : ''}|"
                    th:styleappend="|${'--absence-bar-color:var(--absence-color-' + record.color + ');'}|"
                    th:data-title="${#messages.msg(record.status)}"
                  ></span>
                </th:block>
              </span>
              <span data-grid-ref="title" class="flex items-center gap-2">
                <th:block th:if="${record.type == 'OVERTIME'}">
                  <a
                    th:text="#{overtime.link.overtime}"
                    class="print:hidden text-lg mb-1"
                    th:href="@{__${recordDetailsUrl}__}"
                  ></a>
                  <span
                    th:if="${record.isExternal}"
                    class="text-gray-400 dark:text-zinc-500"
                    th:data-title="#{overtime.details.isExternal}"
                  >
                    <span th:replace="~{icon/cloud-check::svg(className='w-4 h-4')}"></span>
                  </span>
                </th:block>
                <a
                  th:if="${record.type == 'ABSENCE'}"
                  th:text="#{overtime.link.absence}"
                  class="print:hidden text-lg mb-1"
                  th:href="@{__${recordDetailsUrl}__}"
                ></a>
              </span>
              <span data-grid-ref="date-range">
                <th:block th:text="#{absence.period.for}" />
                <th:block
                  th:replace="~{fragments/date-range::date-range-all(from=${record.startDate}, to=${record.endDate})}"
                ></th:block>
              </span>
              <span data-grid-ref="info-split-year">
                <span th:text="${{record.durationByYear.get(selectedYear)}}"></span>
                <span>
                  <th:block th:each="yearDurationEntry, iterStat : ${record.getDurationByYear(selectedYear)}">
                    <th:block
                      th:if="${iterStat.first}"
                      th:text="#{overtime.list.col.duration.additionalInfo.first}"
                    ></th:block>
                    <th:block
                      th:text="#{overtime.list.col.duration.additionalInfo(${{yearDurationEntry.value}}, ${yearDurationEntry.key})}"
                    ></th:block>
                    <th:block
                      th:if="${!iterStat.last}"
                      th:text="#{overtime.list.col.duration.additionalInfo.notLast}"
                    ></th:block>
                  </th:block>
                </span>
              </span>
              <span data-grid-ref="sum">
                <span>Σ</span>
                <span th:text="${{record.sum}}">1 Std. 30 Min. </span>
              </span>
              <span data-grid-ref="action-buttons">
                <a th:if="${record.allowedToEdit}" class="button w-full" th:href="|@{__${recordDetailsUrl}__/edit}|">
                  <svg th:replace="~{icon/pencil::svg(className='w-4 h-4 shrink-0')}"></svg>
                  <span
                    th:text="#{action.edit}"
                    class="ml-2 xs:ml-0 xs:sr-only sm:not-sr-only sm:ml-2 md:sr-only md:ml-0 lg:not-sr-only lg:ml-2"
                  ></span>
                </a>
              </span>
            </li>
          </th:block>
          <li role="separator"></li>
          <li
            th:with="lastYear=${selectedYear - 1}, lastYearUrl=|/web/overtime?person=${person.id}&year=${lastYear}|"
            th:onclick="|navigate('__${lastYearUrl}__');|"
          >
            <span data-grid-ref="plus-minus-icon">
              <svg th:replace="~{icon/reply::svg(className='w-5 h-5 -scale-x-100')}"></svg>
            </span>
            <span data-grid-ref="absence-type-box"></span>
            <span data-grid-ref="title">
              <a
                th:text="#{overtime.link.last-year}"
                class="print:hidden text-lg mb-1"
                th:href="@{/web/overtime?person=__${person.id}__&year=__${lastYear}__}"
              ></a>
            </span>
            <span data-grid-ref="date-range">
              <span th:text="|#{overtime.list.last-year-details} ${lastYear}|"></span>
            </span>
            <span data-grid-ref="info-split-year"></span>
            <span data-grid-ref="sum" th:text="${{overtimeTotalLastYear}}"></span>
            <span data-grid-ref="action-buttons"></span>
          </li>
        </ol>
      </div>
    </main>
  </body>
</html>
