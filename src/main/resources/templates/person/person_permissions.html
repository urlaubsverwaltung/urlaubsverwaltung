<!doctype html>
<html lang="en" th:lang="${language}" th:class="|theme-${theme}|" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="~{_layout::head(title=~{::title}, scriptsDefer=~{::scriptsDefer}, preload=~{::preload})}">
    <title th:text="#{person.form.permissions.header.title}"></title>
    <th:block th:fragment="preload">
      <link rel="preload" th:replace="~{fragments/asset-dependency-preload::links('person_form.js')}" />
    </th:block>
    <th:block th:fragment="scriptsDefer">
      <script defer type="module" asset:src="person_form.js"></script>
    </th:block>
  </head>
  <body th:replace="~{_layout::body(~{::main}, ~{})}">
    <main th:fragment="main" class="max-w-6xl mx-auto px-4 lg:px-12 xl:px-1.5">
      <div th:replace="~{fragments/section-heading::section-heading(~{::person-permissions-body}, ~{})}">
        <th:block th:ref="person-permissions-body">
          <h2 th:text="#{person.form.permissions.title(${person.niceName})}">Berechtigungen für</h2>
        </th:block>
      </div>

      <div class="flex items-center gap-4 sm:gap-6 mb-4 md:mb-12">
        <div th:replace="~{person/box::person-box(person=${person})}"></div>
      </div>

      <form
        method="post"
        th:action="@{/web/person/__${person.id}__/permissions}"
        th:object="${person}"
        class="uv-form uv-form-grid"
      >
        <input type="hidden" th:field="*{id}" th:value="${person.id}" />
        <input type="hidden" th:field="*{niceName}" th:value="${person.niceName}" />
        <input type="hidden" th:field="*{gravatarURL}" th:value="${person.gravatarURL}" />
        <input type="hidden" th:field="*{email}" th:value="${person.email}" />
        <input type="hidden" th:field="*{initials}" th:value="${person.initials}" />

        <p class="uv-form__global-feedback alert alert-danger" th:if="${#fields.hasErrors('permissions')}">
          <th:block th:errors="*{permissions}">permissions Error</th:block>
        </p>

        <div role="group" aria-describedby="group-user-state-description">
          <h2
            id="group-user-state-description"
            class="sr-only"
            th:text="#{person.form.permissions.roles.user_state.description}"
          >
            Status
          </h2>

          <div class="uv-form__group">
            <div class="uv-form__group-info">
              <p class="uv-help-block">
                <svg th:replace="~{icon/info::svg(className='w-4 h-4')}"></svg>
                <th:block th:text="#{person.form.permissions.description}" />
              </p>
            </div>
            <div class="uv-form__input-col">
              <strong class="uv-form__label" th:text="#{person.form.permissions.roles.INACTIVE}"></strong>
              <label>
                <input type="checkbox" th:field="*{permissions}" value="INACTIVE" />
                <span th:text="#{person.form.permissions.roles.INACTIVE.description}">
                  hat keinen Zugang mehr zur Urlaubsverwaltung (Daten des Benutzers bleiben bestehen)
                </span>
              </label>
            </div>
            <div class="uv-form__input-col">
              <strong class="uv-form__label" th:text="#{person.form.permissions.roles.USER}"></strong>
              <label>
                <input type="checkbox" th:field="*{permissions}" value="USER" />
                <span th:text="#{person.form.permissions.roles.USER.description}">
                  hat Zugang zur Urlaubsverwaltung und darf Abwesenheiten für sich selbst beantragen
                </span>
              </label>
            </div>
          </div>
        </div>

        <div role="group" aria-describedby="group-permissions-description">
          <h2
            id="group-permissions-description"
            class="uv-form-legend"
            th:text="#{person.form.permissions.roles.basic_roles.description}"
          >
            Berechtigungen
          </h2>

          <div class="uv-form__group">
            <div class="uv-form__input-col">
              <strong class="uv-form__label" th:text="#{person.form.permissions.roles.DEPARTMENT_HEAD}"></strong>
              <label>
                <input type="checkbox" th:field="*{permissions}" value="DEPARTMENT_HEAD" />
                <span th:text="#{person.form.permissions.roles.DEPARTMENT_HEAD.description}">
                  darf Abwesenheiten für die Benutzer seiner Abteilungen einsehen, genehmigen und ablehnen
                </span>
              </label>
              <div class="ml-4 mt-1 text-sm inline-flex gap-1">
                <svg th:replace="~{icon/info::svg(className='w-4 h-4 translate-y-px')}"></svg>
                <th:block
                  th:if="${#lists.isEmpty(departmentHeadDepartments)}"
                  th:text="#{person.form.permissions.roles.DEPARTMENT_HEAD.departments.none.description}"
                />
                <th:block th:if="${not #lists.isEmpty(departmentHeadDepartments)}">
                  <th:block th:text="#{person.form.permissions.roles.DEPARTMENT_HEAD.departments.description}" />
                  <ul
                    th:if="${departmentHeadDepartments != null && not #lists.isEmpty(departmentHeadDepartments)}"
                    class="mt-1.5 flex flex-wrap text-xs gap-1"
                    th:aria-label="#{person.form.permissions.roles.DEPARTMENT_HEAD.departments.description}"
                  >
                    <li th:each="department : ${departmentHeadDepartments}">
                      <a
                        href="#"
                        th:href="@{/web/absences (department=${department.name})}"
                        th:text="${department.name}"
                        class="px-1.5 no-underline rounded-full bg-emerald-100 text-emerald-800 dark:border dark:border-green-600 dark:text-green-600 dark:bg-transparent print:no-link"
                      >
                        Geschäftsführung
                      </a>
                    </li>
                  </ul>
                </th:block>
              </div>
            </div>
            <div class="uv-form__input-col">
              <strong class="uv-form__label" th:text="#{person.form.permissions.roles.SECOND_STAGE_AUTHORITY}"></strong>
              <label>
                <input type="checkbox" th:field="*{permissions}" value="SECOND_STAGE_AUTHORITY" />
                <span th:text="#{person.form.permissions.roles.SECOND_STAGE_AUTHORITY.description}">
                  ist bei der zweistufigen Genehmigung von Anträgen verantwortlich für die endgültige Freigabe
                </span>
              </label>
              <div class="ml-4 mt-1 text-sm inline-flex gap-1">
                <svg th:replace="~{icon/info::svg(className='w-4 h-4')}"></svg>
                <th:block
                  th:if="${#lists.isEmpty(secondStageDepartments)}"
                  th:text="#{person.form.permissions.roles.SECOND_STAGE_AUTHORITY.departments.none.description}"
                />
                <th:block th:if="${not #lists.isEmpty(secondStageDepartments)}">
                  <th:block th:text="#{person.form.permissions.roles.SECOND_STAGE_AUTHORITY.departments.description}" />
                  <ul
                    th:if="${secondStageDepartments != null && not #lists.isEmpty(secondStageDepartments)}"
                    class="mt-1.5 flex flex-wrap text-xs gap-1"
                    th:aria-label="#{person.form.permissions.roles.DEPARTMENT_HEAD.departments.description}"
                  >
                    <li th:each="department : ${secondStageDepartments}">
                      <a
                        href="#"
                        th:href="@{/web/absences (department=${department.name})}"
                        th:text="${department.name}"
                        class="px-1.5 no-underline rounded-full bg-emerald-100 text-emerald-800 dark:border dark:border-green-600 dark:text-green-600 dark:bg-transparent print:no-link"
                      >
                        Geschäftsführung
                      </a>
                    </li>
                  </ul>
                </th:block>
              </div>
            </div>
            <div class="uv-form__input-col">
              <strong class="uv-form__label" th:text="#{person.form.permissions.roles.BOSS}"></strong>
              <label>
                <input type="checkbox" th:field="*{permissions}" value="BOSS" />
                <span th:text="#{person.form.permissions.roles.BOSS.description}">
                  darf Abwesenheiten aller Benutzer einsehen, genehmigen und ablehnen
                </span>
              </label>
            </div>
            <div class="uv-form__input-col">
              <strong class="uv-form__label" th:text="#{person.form.permissions.roles.OFFICE}"></strong>
              <label>
                <input type="checkbox" th:field="*{permissions}" value="OFFICE" />
                <span th:text="#{person.form.permissions.roles.OFFICE.description}">
                  darf Einstellungen zur Anwendung vornehmen
                </span>
              </label>
            </div>
          </div>
        </div>

        <div role="group" aria-describedby="group-additional-permissions-description">
          <h2
            id="group-additional-permissions-description"
            class="uv-form-legend"
            th:text="#{person.form.permissions.roles.additional_roles.description}"
          >
            Zusätzliche Berechtigungen
          </h2>

          <div class="uv-form__group">
            <div class="uv-form__input-col">
              <strong
                class="uv-form__label"
                th:text="#{person.form.permissions.roles.SICK_NOTE_VIEW_ADD_EDIT}"
              ></strong>
              <label>
                <input type="checkbox" th:field="*{permissions}" value="SICK_NOTE_VIEW_ADD_EDIT" />
                <span
                  th:text="#{person.form.permissions.roles.SICK_NOTE_VIEW_ADD_EDIT.description(${person.niceName})}"
                >
                  darf Krankmeldungen aller Mitarbeitenden pflegen
                </span>
              </label>
            </div>
            <div class="uv-form__input-col">
              <strong
                class="uv-form__label"
                th:text="#{person.form.permissions.roles.APPLICATION_ADD_CANCEL_EDIT}"
              ></strong>
              <label>
                <input type="checkbox" th:field="*{permissions}" value="APPLICATION_ADD_CANCEL_EDIT" />
                <span
                  th:text="#{person.form.permissions.roles.APPLICATION_ADD_CANCEL_EDIT.description(${person.niceName})}"
                >
                  darf Abwesenheiten aller Mitarbeitenden pflegen
                </span>
              </label>
            </div>
          </div>
        </div>

        <div class="uv-form__actions">
          <button type="submit" class="button-main-green w-56" th:text="#{action.save}">Speichern</button>
          <button data-back-button th:text="#{action.cancel}" type="button" class="button">Abbrechen</button>
        </div>
      </form>
    </main>
  </body>
</html>
