<!doctype html>
<html lang="en" th:lang="${language}" th:class="|theme-${theme}|" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="~{_layout::head(title=~{::title}, scriptsDefer=~{::scriptsDefer}, preload=~{::preload})}">
    <title th:text="#{sicknote.convert.header.title}">Krankmeldung in Abwesenheit umwandeln</title>
    <th:block th:fragment="preload">
      <link rel="preload" th:replace="~{fragments/asset-dependency-preload::links('sick_note_convert.js')}" />
    </th:block>
    <th:block th:fragment="scriptsDefer">
      <script defer type="module" asset:src="sick_note_convert.js"></script>
    </th:block>
  </head>

  <body th:replace="~{_layout::body(~{::main}, ~{})}">
    <main th:fragment="main">
      <form
        method="post"
        th:action="@{/web/sicknote/__${sickNote.id}__/convert}"
        th:object="${sickNoteConvertForm}"
        class="max-w-2xl lg:max-w-6xl mx-auto px-4 lg:px-12 xl:px-0"
      >
        <div class="grid gap-4 lg:grid-cols-2 lg:gap-8">
          <div>
            <div th:replace="~{fragments/section-heading::section-heading(~{::sicknote-convert-heading-body}, ~{})}">
              <th:block th:ref="sicknote-convert-heading-body">
                <h2 th:text="#{sicknote.convert.title}" class="lg:truncate">Krankmeldung in Abwesenheit umwandeln</h2>
              </th:block>
            </div>

            <div class="space-y-4">
              <div class="lg:flex lg:items-center lg:gap-4">
                <input id="person-input" type="hidden" name="person" th:value="${sickNoteConvertForm.person.id}" />
                <label for="person-input" th:text="|#{sicknote.data.person}:|" class="lg:w-1/3"></label>
                <div class="flex-1" th:text="${sickNoteConvertForm.person.niceName}"></div>
              </div>

              <div class="lg:flex lg:gap-4 lg:items-center">
                <label for="vacationType" th:text="|#{application.data.vacationType}:|" class="is-required lg:w-1/3">
                  Art der Abwesenheit
                </label>
                <div class="flex-1">
                  <select
                    th:replace="~{fragments/select::one(id='vacationType', name='vacationType', options=~{::sicknote-vacationtype-select-options})}"
                    id="vacationType"
                  >
                    <th:block th:fragment="sicknote-vacationtype-select-options">
                      <option
                        th:each="vacationType: ${vacationTypes}"
                        th:text="${vacationType.getLabel(locale)}"
                        th:value="${vacationType.id}"
                        th:selected="${sickNoteConvertForm.vacationType != null && sickNoteConvertForm.vacationType == vacationType.id}"
                      ></option>
                    </th:block>
                  </select>
                </div>
              </div>

              <div class="lg:flex lg:gap-4 lg:items-center">
                <input type="hidden" th:field="*{dayLength}" />
                <input type="hidden" th:field="*{startDate}" />
                <input type="hidden" th:field="*{endDate}" />

                <label class="lg:w-1/3" th:text="|#{absence.period}|">Zeitraum</label>

                <div class="flex-1 text-sm">
                  <th:block th:text="#{absence.period.for}" />
                  <th:block
                    th:replace="~{fragments/date-range::date-range-all(
                    from=${sickNoteConvertForm.startDate},
                    to=${sickNoteConvertForm.endDate},
                    dayLength=${sickNoteConvertForm.dayLength}
                  )}"
                  ></th:block>
                </div>
              </div>

              <div class="lg:flex lg:items-center lg:gap-4">
                <label for="reason" class="is-required lg:w-1/3" th:text="|#{application.data.reason}:|">Grund</label>
                <div class="flex-1">
                  <textarea id="reason" th:field="*{reason}" th:errorclass="error" rows="2"></textarea>
                  <p class="mt-1 text-sm text-red-800 dark:text-red-400" th:if="${#fields.hasErrors('reason')}">
                    <th:block th:errors="*{reason}">reason Error</th:block>
                  </p>
                </div>
              </div>
            </div>
          </div>

          <div>
            <div th:replace="~{fragments/section-heading::section-heading(~{::sicknote-heading-body}, ~{})}">
              <th:block th:ref="sicknote-heading-body">
                <h2 th:text="#{sicknote.title}">Krankmeldung</h2>
              </th:block>
            </div>
            <div class="box p-5">
              <div th:replace="~{fragments/box::box-with-icon(~{::sicknote-box-icon}, ~{::sicknote-box-body})}">
                <th:block th:ref="sicknote-box-icon">
                  <div
                    th:replace="~{fragments/rounded::block(content=~{::sicknote-box-icon-rounded}, className='bg-red-500 text-white dark:bg-red-600 dark:text-zinc-900')}"
                  >
                    <th:block th:ref="sicknote-box-icon-rounded">
                      <th:block th:if="${sickNote.sickNoteType.category.name == 'SICK_NOTE_CHILD'}">
                        <svg th:replace="~{icon/child::svg(className='w-8 h-8')}"></svg>
                      </th:block>
                      <th:block th:if="${sickNote.sickNoteType.category.name != 'SICK_NOTE_CHILD'}">
                        <svg th:replace="~{icon/medkit::svg(className='w-8 h-8')}"></svg>
                      </th:block>
                    </th:block>
                  </div>
                </th:block>
                <th:block th:ref="sicknote-box-body">
                  <span
                    th:text="#{sicknotes.details.box.person.has(${sickNote.person.niceName})}"
                    class="text-sm text-black/75 dark:text-zinc-300"
                  >
                  </span>
                  <span th:text="#{__${sickNote.sickNoteType.messageKey}__}" class="my-1 text-lg font-medium"> </span>
                  <span class="text-sm text-black/75 dark:text-zinc-300">
                    <th:block th:text="#{absence.period.for}" />
                    <th:block
                      th:replace="~{fragments/date-range::date-range-all(
                      from=${sickNoteConvertForm.startDate},
                      to=${sickNoteConvertForm.endDate},
                      dayLength=${sickNoteConvertForm.dayLength}
                    )}"
                    ></th:block>
                  </span>
                </th:block>
              </div>
            </div>
            <table class="list-table striped-table bordered-table text-sm mt-4">
              <tbody>
                <tr>
                  <td th:text="#{absence.period.duration}"></td>
                  <td>
                    <span th:text="#{sicknote.data.days(${sickNote.workDays})}"></span>
                  </td>
                </tr>
                <tr>
                  <td th:text="#{sicknote.data.aub.short}"></td>
                  <td>
                    <th:block th:if="${sickNote.aubPresent}">
                      <div class="flex items-center">
                        <th:block th:text="#{absence.period.for}" />
                        <th:block
                          th:replace="~{fragments/date-range::date-range-all(
                          from=${sickNote.aubStartDate},
                          to=${sickNote.aubEndDate}
                        )}"
                        ></th:block>
                      </div>
                      <div th:text="#{sicknote.data.days(${sickNote.workDaysWithAub})}"></div>
                    </th:block>
                    <th:block th:if="${not sickNote.aubPresent}">
                      <div class="flex items-center">
                        <svg th:replace="~{icon/x-circle::svg(className='w-4 h-4')}"></svg>
                        &nbsp;<th:block th:text="#{sicknote.data.aub.notPresent}"></th:block>
                      </div>
                    </th:block>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <hr class="mt-6" />

        <div class="mt-6 flex justify-between gap-4">
          <button id="apply-application" type="submit" class="button-main-green w-56" th:text="#{action.save}">
            Speichern
          </button>
          <button data-back-button th:text="#{action.cancel}" type="button" class="button">Abbrechen</button>
        </div>
      </form>
    </main>
  </body>
</html>
